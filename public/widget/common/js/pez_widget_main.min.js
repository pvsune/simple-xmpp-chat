function log(e){}function trace(e){}function get_xmpp_config(){var e={url:null,host:"localhost",admin_user:"admin@localhost"};return pez_widget_url.indexOf("localhost")>-1?e.url="http://localhost:5280/http-bind":e.url="//xmpp.dev.pez.ai/http-bind",e}function get_dataform_response(e){var t={clientauth:"[authsuccess]",userdata:"[userdatareceived]",authfail:"[fail]"};return void 0!=t[e]?t[e]:null}function unit_test(e,t){}function docdiv(e){var t=document.getElementById(pez_widget_prefix+e);return"undefined"==typeof t||null==t?(log("Undefined Element: "+pez_widget_prefix+e),null):t}function framediv(e){var t=i_framedoc.getElementById(pez_widget_prefix+e);return"undefined"==typeof t||null==t?(log("Undefined Element: "+pez_widget_prefix+e),null):t}function load_divs(){i_container=docdiv("container")}function load_framedivs(){i_form=framediv("form"),i_form_button=framediv("form-button"),i_form_error=framediv("form-error"),i_user_firstname=framediv("form-first-name"),i_user_lastname=framediv("form-last-name"),i_user_email=framediv("form-email"),i_user_phone=framediv("form-phone"),i_user_question=framediv("form-question"),i_input_area=framediv("input-area"),i_send_button=framediv("send-button"),i_message=framediv("message"),i_messages_area=framediv("messages-area"),i_messages_area_inner=framediv("messages"),button_events()}function messageHandler(e){trace(" -> messageHandler");var t=(e.getAttribute("to"),e.getAttribute("from")),i=e.getAttribute("type"),n=e.getElementsByTagName("body");if("chat"==i&&n.length>0){var a=Strophe.getText(n[0]);if(a)if(a==get_dataform_response("clientauth"))log("Auth Success"),post_auth();else if(a!=get_dataform_response("authfail")){log(t+": "+a);var s=append_message("server",a,null);add_message_cookie("server",a,s),increment_unread_count(),activate_chat()}}else log("Received "+i+" with body:"),log(n);return unit_test("messageHandler",e),!0}function send_message(e){if(trace(" -> send_message"),e=e.trim(),""!=e){var t=e,i=msgpack.encode(JSON.stringify({message:e,api_key:pez_widget_api_key,page_id:pez_widget_client_domain}));e="";for(var n=0,a=i.length;a>n;n+=1)e+=(i[n]<=15?"0":"")+i[n].toString(16);var s=$msg({to:xmpp.admin_user,from:connection.jid,type:"chat"}).c("body").t(e);connection.send(s.tree());var r=append_message("user",t,null);add_message_cookie("user",t,r),process_non_text(t,r),offline_options(t),i_message.value="",i_message.focus(),unit_test("send_message",t)}}function append_message(e,t,i){trace(" -> append_message");var n=i;null==i&&(i=date_timestamp(new Date));var a="",s="";"user"==e?(s="",a=user_firstname):(s=pez_widget_url+"clients/"+client.avatar+"?"+seed,a=client.name),t=convert_links(t);var r="";"server"==e&&(r='<div class="pez-widget-comment-container-'+e+'-avatar">\n<div class="pez-widget-avatar">\n<img src="'+s+'">\n</div>\n</div>');var o=i_framedoc.createElement("div");return o.className=pez_widget_prefix+"conversation-part "+pez_widget_prefix+"conversation-part-"+e+" "+pez_widget_prefix+"conversation-part-grouped",o.innerHTML='<div id="'+pez_widget_prefix+"container-"+i+'" class="'+pez_widget_prefix+"comment-container "+pez_widget_prefix+"comment-container-"+e+'">\n'+r+'\n<div class="'+pez_widget_prefix+'comment">\n<div class="'+pez_widget_prefix+'blocks">\n<div class="'+pez_widget_prefix+"block "+pez_widget_prefix+'block-paragraph">\n<div id="'+pez_widget_prefix+"msg-"+i+'" class="text">\n'+t+'\n</div>\n</div>\n</div>\n</div>\n</div>\n<span>\n<div class="'+pez_widget_prefix+'conversation-part-metadata">\n<div class="'+pez_widget_prefix+'conversation-part-metadata-save-state">\n<span class="'+pez_widget_prefix+"timestamp "+i+'"><em>Just Now</em></span>\n</div>\n</div>\n</span>',i_messages_area_inner.appendChild(o),setTimeout(scroll_down,500),unit_test("append_message",[e,t,n]),i}function send_auth(){if(trace(" -> send_auth"),pez_widget_online&&pez_widget_required_auth){log("Authenticating API");var e=$msg({to:xmpp.admin_user,from:connection.jid,type:"chat"}).c("x",{xmlns:"jabber:x:data",type:"result"}).c("title","clientauth").up().c("instructions","").up().c("field",{"var":"api_key",type:"text-single",label:"API Key"}).c("descp","API Key").up().c("required").up().c("value",pez_widget_api_key).up().up().c("field",{"var":"domain",type:"text-single",label:"Client Domain"}).c("descp","Client Domain").up().c("required").up().c("value",pez_widget_client_domain);connection.send(e)}}function post_auth(){trace(" -> post_auth"),load_widget()}function process_form(){if(trace(" -> process_form"),user_firstname=i_user_firstname.value.trim(),user_lastname=i_user_lastname.value.trim(),user_email=i_user_email.value.trim(),user_phone=i_user_phone.value.trim(),user_question=i_user_question.value.trim(),""==user_firstname)i_form_error.innerText="First Name is required",i_user_firstname.focus();else if(""==user_lastname)i_form_error.innerText="Last Name is required",i_user_lastname.focus();else if(""==user_email||validate_email(user_email)){if(i_user_firstname.disabled=!0,i_user_lastname.disabled=!0,i_user_email.disabled=!0,i_user_phone.disabled=!0,i_user_question.disabled=!0,i_form_button.disabled=!0,i_form_error.innerText="Saving your info...",save_form(),pez_widget_send_userdata&&send_user_info(),""!=user_question)send_message(user_question);else{client=get_client_data();var e=append_message("server",client.welcome_message,null);add_message_cookie("server",client.welcome_message,e),increment_unread_count()}activate_chat()}else i_form_error.innerText="Email is invalid",i_user_email.focus(),i_user_email.select()}function save_form(){trace(" -> save_form");var e=user_question.replace("\n"," ").replace(";","");set_cookie("user-firstname",user_firstname),set_cookie("user-lastname",user_lastname),set_cookie("user-email",user_email),set_cookie("user-phone",user_phone),set_cookie("user-question",e)}function validate_email(e){trace(" -> validate_email");var t=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)}function send_user_info(){if(trace(" -> send_user_info"),pez_widget_online){var e=$msg({to:xmpp.admin_user,from:connection.jid,type:"chat"}).c("x",{xmlns:"jabber:x:data",type:"result"}).c("title","userdata").up().c("instructions","Pre-chat form data").up().c("field",{"var":"first_name",type:"text-single",label:"First Name"}).c("descp","First Name").up().c("required").up().c("value",user_firstname).up().up().c("field",{"var":"last_name",type:"text-single",label:"Last Name"}).c("descp","Last Name").up().c("required").up().c("value",user_lastname).up().up().c("field",{"var":"email",type:"text-single",label:"Email"}).c("descp","User Email").up().c("required").up().c("value",user_email).up().up().c("field",{"var":"phone",type:"text-single",label:"Phone"}).c("descp","User Phone").up().c("required").up().c("value",user_phone).up().up().c("field",{"var":"question",type:"text-single",label:"Question"}).c("descp","User Question").up().c("required").up().c("value",user_question).up().up().c("field",{"var":"api_key",type:"text-single",label:"API Key"}).c("descp","API Key").up().c("required").up().c("value",pez_widget_api_key);connection.send(e)}}function restore_data(){trace(" -> restore_data");var e=get_cookie("user-firstname");if(null!=e&&""!=e){activate_chat(),user_firstame=e,user_lastname=get_cookie("user-lastname"),user_email=get_cookie("user-email"),user_phone=get_cookie("user-phone"),user_question=get_cookie("user-question"),log("User data is present");var t=get_cookie("messages");if(t!={}){has_previous_messages=!0,log("Previous messages are present");var i=[];for(var n in t)i.push(n);i=i.sort(),i.length>30&&(i=i.slice(i.length-30,i.length));var a,s;for(s=0;s<i.length;s++)n=i[s],a=t[n],append_message(a.sender,unescape(a.message),n);update_timestamps(),i_message.focus()}else log("No previous messages")}}function offline_options(e){trace(" -> offline_options"),pez_widget_online||fake_reply(e)}function fake_reply(e){trace(" -> fake_reply"),setTimeout(function(){var t="Chat server is offline";"show link"==e?t="http://pez.ai/about":"show image"==e?t="http://pez.ai/wp-content/uploads/2015/08/brian.jpg":"show video"==e&&(t="https://www.youtube.com/embed/WXHM_i-fgGo"),add_message_cookie("server",t,new Date);var i=append_message("server",t,null);process_non_text(t,i)},2e3)}function process_non_text(e,t){trace(" -> process_non_text");var i=framediv("container-"+t);i.classList.remove("wide"),"http"==e.substring(0,4)&&(display_spinner(t),i.classList.add("wide"),process_video(e,t))}function process_video(e,t){if(-1!==e.indexOf("youtube.com/watch")||-1!==e.indexOf("youtube.com/embed/")||-1!==e.indexOf("youtu.be/")){var i="",n=e;-1!==e.indexOf("watch?v=")?i=e.split("watch?v=")[1].split("?")[0].split("#")[0].split("&")[0]:-1!==e.indexOf("youtu.be/")&&(i=url.split("youtu.be/")[1].split("?")[0].split("#")[0].split("&")[0]),""!=i&&(n="https://www.youtube.com/embed/"+i),framediv("msg-"+t).innerHTML='<div class="video"><iframe style="width:100% !important;height:250px;" src="'+n+'" frameborder="0" allowfullscreen></iframe></div>\n<div class="url"><a href="'+e+'" target="_blank">Watch in YouTube</a></div>'}else process_link(e,t)}function process_link(e,t){var i=encodeURIComponent(e),n="59b23d0ebf6665630cf1e35a",a="https://opengraph.io/api/1.0/site/"+i+"?app_id="+n;xhr=new XMLHttpRequest,xhr.open("GET",a,!0),xhr.onload=function(){4===xhr.readyState&&200===xhr.status?display_link(JSON.parse(xhr.responseText),e,t):log("Error "+xhr.status)},xhr.send()}function process_image(e,t){var i=document.createElement("img");i.setAttribute("src",e),i.onerror=function(e,t){process_video(e,t)}(e,t),framediv("msg-"+t).innerHTML='<div class="image"><a href="'+i.src+'" target="_blank"><img src="'+i.src+'" /></a></div>\n<div class="url"><a href="'+i.src+'" target="_blank">View Full Size</a></div>'}function display_link(e,t,i){trace(" -> display_link");var n=framediv("msg-"+i);if(null!=e.error)framediv("msg-"+i).innerHTML='<div class="image"><a href="'+t+'" target="_blank"><img src="'+t+'" /></a></div>\n<div class="url"><a href="'+t+'" target="_blank">View Full Size</a></div>';else if(null!=e.hybridGraph){var a="";""!=e.hybridGraph.image&&(a='<div class="image"><a href="'+t+'" target="_blank"><img src="'+e.hybridGraph.image+'" style="width:100%;height:auto;" /></a></div>'),title=e.hybridGraph.title,""==title?title="Untitled":title.length>100&&(title=title.substring(0,100).trim()+"..."),descp=e.hybridGraph.description,descp.length>100&&(descp=descp.substring(0,100).trim()+"..."),n.innerHTML=a+'\n<div class="title"><a href="'+t+'" target="_blank">'+title+'</a></div>\n<div class="descp">'+descp+'</div>\n<div class="url"><a href="'+t+'" target="_blank">Open Link</a></div>'}setTimeout(scroll_down,500)}function convert_links(e){return"http"==e.substring(0,4)&&(e='<a href="'+e+'" target="_blank">'+e+"</a>"),e}function activate_chat(){trace(" -> activate_chat"),i_form.style.display="none",i_input_area.style.display="block",i_message.focus()}function scroll_down(){trace(" -> scroll_down"),i_messages_area.scrollTop=i_messages_area.scrollHeight}function display_spinner(e){trace(" -> display_spinner");var t=framediv("msg-"+e);null!=t&&(t.className="preview",t.innerHTML='<div class="spinner"><img src="'+pez_widget_url+"common/images/spinner.gif?"+seed+'" width="24" height="24" /></div>')}function restore_launcher_status(){trace(" -> restore_launcher_status"),"desktop"!=pez_widget_device?show_widget():"closed"==get_cookie("launcher-status")?hide_widget():show_widget()}function update_timestamps(){trace(" -> update_timestamps");var e=i_framedoc.getElementsByClassName(pez_widget_prefix+"timestamp");if(e.length>0){var t,i,n,a,s,r,o,d,_=new Date,c=new Date;for(c.setDate(_.getDate()-1),t=0;t<e.length;t++)i=e[t].className.split(" ")[1],n=new Date(i.substring(0,4),parseInt(i.substring(4,6))-1,i.substring(6,8),i.substring(8,10),i.substring(10,12),i.substring(12,14)),r=Math.floor((_.getTime()-n.getTime())/1e3),1>r?o="Just now":60>r?o=r+" seconds ago":3600>r?o=Math.floor(r/60)+" minutes ago":(o="",i.substr(0,8)!=date_timestamp(_).substring(0,8)&&(i.substr(0,8)==date_timestamp(c).substring(0,8)?o="Yesterday":(o=month_name(n.getMonth())+" "+n.getDate(),_.getFullYear()-n.getFullYear()>0&&(o+=", "+n.getFullYear())),o+=" "),a=parseInt(n.getHours()),s="am",0==a?a=12:12e4==parseInt(i.substring(8,14))?s="nn":parseInt(i.substring(8,14))>12e4&&(a>12&&(a-=12),s="pm"),d=a+":"+n.getMinutes()+" "+s,o+=d),e[t].innerHTML="<em>"+o+"</em>",e[t].title=month_name(n.getMonth())+" "+n.getDate()+", "+n.getFullYear()+" "+d}}function increment_unread_count(){if(trace(" -> increment_unread_count"),"closed"==get_cookie("launcher-status")){var e=parseInt(get_cookie("unread-messages"));set_cookie("unread-messages",e+1),update_speech_bubble()}}function update_speech_bubble(){trace(" -> update_speech_bubble");var e=parseInt(get_cookie("unread-messages"));e>0?i_bubble.innerHTML='<span id="'+pez_widget_prefix+'unread-counter" class="unread">'+e+" Unread Messages</span>":i_bubble.innerHTML="<span>Talk with "+client.name+"!</span>"}function load_widget(){trace(" -> load_widget");var e=docdiv("container-span");e.innerHTML='<div class="'+pez_widget_prefix+'frame"></div>',i_frame=document.createElement("iframe"),i_frame.setAttribute("allowfullscreen","true"),i_frame.style.height="530px",i_frame.id=pez_widget_prefix+"iframe",document.getElementsByClassName(pez_widget_prefix+"frame")[0].appendChild(i_frame);var t='<!DOCTYPE html>\n<html>\n<head>\n<link href="'+pez_widget_url+"common/css/pez_widget_main_"+pez_widget_device+pez_widget_dotmin+".css?"+seed+'" rel="stylesheet" type="text/css" />\n<link href="'+pez_widget_url+"clients/"+pez_widget_client+".css?"+seed+'" rel="stylesheet" type="text/css" />\n</head>\n<body id="'+pez_widget_prefix+'container-body">\n<div id="'+pez_widget_prefix+'container">\n<div data-reactroot="" class="'+pez_widget_prefix+'messenger">\n<div class="'+pez_widget_prefix+'messenger-background"></div>\n<span>\n<div class="'+pez_widget_prefix+'conversation">\n<div class="'+pez_widget_prefix+'conversation-body-container">\n<div class="'+pez_widget_prefix+'conversation-body" style="transform: translateY(-228.2px); bottom: -228.2px;">\n<div class="'+pez_widget_prefix+'conversation-body-profile">\n<div class="'+pez_widget_prefix+'conversation-profile">\n<div class="'+pez_widget_prefix+'team-profile">\n<div class="'+pez_widget_prefix+'team-profile-compact">\n<div class="'+pez_widget_prefix+'team-profile-compact-contents">\n<div class="'+pez_widget_prefix+'team-profile-compact-body">\n<div class="'+pez_widget_prefix+'team-profile-compact-team-name">'+client.name+'</div>\n<div class="'+pez_widget_prefix+'team-profile-compact-response-delay">\n<span class="'+pez_widget_prefix+'team-profile-response-delay-text">'+client.slogan+'</span>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div id="'+pez_widget_prefix+'messages-area" class="'+pez_widget_prefix+'conversation-body-parts" style="top: 303.2px; bottom: 56px;">\n<div class="'+pez_widget_prefix+'conversation-body-parts-wrapper">\n<div class="'+pez_widget_prefix+"conversation-parts "+pez_widget_prefix+'conversation-parts-scrolled" style="transform: translateY(0px);">\n<div id="'+pez_widget_prefix+'messages"></div>\n</div>\n</div>\n</div>\n<div id="'+pez_widget_prefix+'form" style="display:block;">\n<div class="field field-first-name">\n<div class="label">First Name*</div>\n<div class="input-holder">\n<input type="text" id="'+pez_widget_prefix+'form-first-name" />\n</div>\n</div>\n<div class="field field-last-name">\n<div class="label">Last Name*</div>\n<div class="input-holder">\n<input type="text" id="'+pez_widget_prefix+'form-last-name" />\n</div>\n</div>\n<div class="field field-email">\n<div class="label">E-mail</div>\n<div class="input-holder">\n<input type="text" id="'+pez_widget_prefix+'form-email" />\n</div>\n</div>\n<div class="field field-phone">\n<div class="label">Phone</div>\n<div class="input-holder">\n<input type="text" id="'+pez_widget_prefix+'form-phone" />\n</div>\n</div>\n<div class="field field-question">\n<div class="label">Your Question</div>\n<div class="input-holder">\n<textarea size="3" id="'+pez_widget_prefix+'form-question"></textarea>\n</div>\n</div>\n<div class="field button">\n<button type="button" id="'+pez_widget_prefix+'form-button" class="gradient">Start Chat!</button>\n</div>\n<div class="field error">\n<div id="'+pez_widget_prefix+'form-error"></div>\n</div>\n</div>\n</div>\n<span></span>\n</div>\n<div class="'+pez_widget_prefix+'conversation-footer" id="'+pez_widget_prefix+'input-area" style="display:none;">\n<div class="'+pez_widget_prefix+'composer">\n<pre><br></pre>\n<textarea placeholder="Write a replyâ€¦" id="'+pez_widget_prefix+'message"></textarea>\n<span></span>\n<span></span>\n<div class="'+pez_widget_prefix+'composer-buttons">\n<button type="button" id="'+pez_widget_prefix+'send-button">Send</button>\n</div>\n</div>\n</div>\n</div>\n</span>\n</div>\n</div>\n</body>\n</html>';i_framedoc=i_frame.contentDocument||i_frame.contentWindow.document,i_framedoc.open(),i_framedoc.write(t),i_framedoc.close(),iframe_loaded()}function show_widget(){trace(" -> show_widget"),docdiv("container-span").style.display="block",docdiv("launcher-close").style.display="block",docdiv("launcher-open").style.display="none",set_cookie("launcher-status","open"),scroll_down()}function hide_widget(){trace(" -> hide_widget"),docdiv("container-span").style.display="none",docdiv("launcher-close").style.display="none",docdiv("launcher-open").style.display="block",set_cookie("launcher-status","closed")}function iframe_loaded(){load_divs(),load_framedivs(),i_container.style.display="block",restore_data(),restore_launcher_status();var e=get_client_data();if(!e.pre_chat){if(!has_previous_messages){var t=append_message("server",e.welcome_message,null);add_message_cookie("server",e.welcome_message,t),increment_unread_count(),send_user_info(),set_cookie("user-name",""),set_cookie("user-email",""),set_cookie("user-phone",""),set_cookie("user-question","")}activate_chat()}setInterval(update_timestamps,5e3)}function set_cookie(e,t){trace(" -> set_cookie");var i=get_all_cookies();i[e]=t;var n=new Date((new Date).getTime()+15768e7);delete_all_cookies(),document.cookie=pez_widget_prefix+"data="+JSON.stringify(i)+"; expires="+n.toUTCString()+"; path=/",log("Cookie: "+e+"="+t)}function get_cookie(e){var t=get_all_cookies();return t!={}&&void 0!=t[e]?t[e]:null}function get_all_cookies(){var e=document.cookie.match(new RegExp(pez_widget_prefix+"data=([^;]+)"));if(e){try{var t=JSON.parse(e[1])}catch(i){return delete_all_cookies(),{}}return t}return{}}function delete_all_cookies(){var e=new Date((new Date).getTime()-31536e6);document.cookie=pez_widget_prefix+"data=; expires="+e.toUTCString()+"; path=/",log("Deleted Corrupt Cookies")}function add_message_cookie(e,t,i){trace(" -> add_message_cookie");var n=get_all_cookies();void 0==n.messages&&(n.messages={}),n.messages&&(n.messages[date_timestamp(i)]={sender:e,message:t}),set_cookie("messages",n.messages)}function date_timestamp(e){function t(e){return(10>e?"0":"")+e}return e instanceof Date||(e=new Date),e.getFullYear()+t(e.getMonth()+1)+t(e.getDate())+t(e.getHours())+t(e.getMinutes())+t(e.getSeconds())+t(e.getMilliseconds())}function month_name(e){var t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return t[e]}function escape_schars(e){return e.replace(/\\n/g,"\\n").replace(/\\'/g,"\\'").replace(/\\"/g,'\\"').replace(/\\&/g,"\\&").replace(/\\r/g,"\\r").replace(/\\t/g,"\\t").replace(/\\b/g,"\\b").replace(/\\f/g,"\\f")}function update_jid(){trace(" -> update_jid"),pez_widget_jid=get_cookie("jid"),null==pez_widget_jid&&(pez_widget_jid=(new Date).getTime()+"@localhost",set_cookie("jid",pez_widget_jid))}function connect(){trace(" -> connect"),update_jid(),connection.connect(pez_widget_jid,"",connectHandler)}function connectHandler(e){trace(" -> connectHandler"),e==Strophe.Status.CONNECTED?(log("Connected"),connection.addHandler(presenceHandler,null,"presence"),connection.addHandler(pingHandler,"urn:xmpp:ping","iq","get"),connection.addHandler(messageHandler,null,"message",null,null,null),connection.send($pres().tree()),post_connection()):e==Strophe.Status.AUTHFAIL?log("Authentication Fail"):e==Strophe.Status.CONNECTING?log("Connecting"):e==Strophe.Status.CONNFAIL?log("Connection Fail"):e==Strophe.Status.DISCONNECTED?log("Disconnected"):e==Strophe.Status.DISCONNECTING?log("Disconnectin"):e==Strophe.Status.ERROR?log("Error"):e==Strophe.Status.ATTACHED?log("Attached"):e==Strophe.Status.AUTHENTICATING&&log("Authenticating")}function post_connection(){trace(" -> post_connection"),pez_widget_online?pez_widget_required_auth?send_auth():(log("Skipped authentication"),post_auth()):post_auth()}function button_events(){trace(" -> button_events");var e=docdiv("launcher-open"),t=docdiv("launcher-close");e.addEventListener("click",function(e){show_widget()},!1),t.addEventListener("click",function(e){hide_widget()},!1),i_form_button.addEventListener("click",process_form,!1),i_send_button.addEventListener("click",function(e){send_message(i_message.value)},!1),i_message.addEventListener("keyup",function(e){e=e||window.event,13==e.keyCode&&send_message(i_message.value)},!1)}function presenceHandler(e){trace(" -> presenceHandler");var t=e.getAttribute("from"),i="",n="";return Strophe.forEachChild(e,"show",function(e){i=e.textContent}),Strophe.forEachChild(e,"status",function(e){n=e.textContent}),(i||n)&&log("[presence] "+t+":"+n+" "+i),!0}function pingHandler(e){trace(" -> pingHandler");var t=e.getAttribute("id"),i=e.getAttribute("from"),n=e.getAttribute("to"),a=$iq({type:"result",to:i,id:t,from:n});return connection.send(a),!0}function set_raw_handlers(){trace(" -> set_raw_handlers"),connection.rawInput=function(e){pez_widget_debug&&log("Raw Received: "+e)},connection.rawOutput=function(e){pez_widget_debug&&log("Raw Sent: "+e)}}function update_status(e,t){trace(" -> update_status");var i=$pres().c("show").t(e).up().c("status").t(t);connection.send(i)}var pez_widget_online=!0,pez_widget_required_auth=!1,pez_widget_send_userdata=!0,pez_widget_debug=!1,pez_widget_prefix="pez-widget-",seed=Math.floor(Date.now()/1e3),client=get_client_data(),xmpp=get_xmpp_config(),pez_widget_jid=null,i_frame,i_framedoc,is_iframe_not_loaded=!0,i_container,i_form,i_form_button,i_form_error,i_user_firstname,i_user_lastname,i_user_email,i_user_phone,i_user_question,i_input_area,i_send_button,i_message,i_messages_area,i_messages_area_inner,user_firstname="",user_lastname="",user_email="",user_phone="",user_question="",has_previous_messages=!1,connection=new Strophe.Connection(xmpp.url);set_raw_handlers(),pez_widget_online?connect():post_connection();