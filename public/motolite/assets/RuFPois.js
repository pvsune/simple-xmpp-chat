function RuFPois(){var ChangeProtocolToWindowProtocol,useStandardBoxes,useRoundBoxes;this.flagImages={},this.flagImages.Path="/_mmm/css/ruf/icons/maps_icons/",this.flagImages.Extension=".gif",this.flagImages.Small="/_common/img/trans.gif",this.flagImages.Big="/_common/img/trans.gif",this.divShowAllLowOpacity="20",this.MapDx=4e4,this.MapDy=4e4,this.MapRect=null,this.HiddenListboxId={},this.HiddenListboxId.Active="lstGeocodingResult",this.HiddenListboxId.Default="lstGeocodingResult",this.HiddenListboxId.GeocodingLayer="lstGeocodingResultGeocodingLayer",this.MarkRegionsWithIcon=!1,this.showGeocodingResults=function(isNew){RUFPOIS.HiddenListboxId.Active=RUFPOIS.HiddenListboxId.GeocodingLayer,this.showResults(isNew),RUFPOIS.HiddenListboxId.Active=RUFPOIS.HiddenListboxId.Default},this.showResults=function(isNew,PoiIds,ForceMapZoomedOut){var geocodingResults,thisMap,_x1,_y1,_x2,_y2,_poityp,_infourl,Length,mggAry,idsmall,MercatorPoint2,smartpoint2,zoomLevel,MapRect,i,bShowInfoxBox,_PoiImage,xCenter,yCenter;if(ForceMapZoomedOut!=null&&ForceMapZoomedOut==!0){this.ZoomMapOutAndShowResults(isNew,PoiIds);return}isNew&&(this.selectedKey=null,this.surroundingRect=null,this.clearAllElements()),geocodingResults=this.getResultAsMggStrings();if(geocodingResults!=null){thisMap=AMAMAPS.AMAgetAJAXMapReference();if(thisMap!=null){Length=geocodingResults.length,PoiIds!=null&&(Length=PoiIds.split("|").length,PoiIds="|"+PoiIds+"|");var ary=new Array(Length),ary2=new Array(Length),arIndex=new Array(Length),iCounter=0;if(geocodingResults.length>0){for(i=0;i<geocodingResults.length;i++){mggAry=geocodingResults[i].split("|"),idsmall=mggAry[0];if(PoiIds==null||PoiIds.indexOf("|"+idsmall+"|")>=0){_x1=parseFloat(mggAry[2]),_y1=parseFloat(mggAry[3]),_x2=parseFloat(mggAry[4]),_y2=parseFloat(mggAry[5]);var MercatorPoint1={x:_x1,y:_y1},smartpoint1=AMAMAPS.AMAMercator_2_SmartUnits(MercatorPoint1),smartpoint2={x:0,y:0};_x2!=0&&(MercatorPoint2={x:_x2,y:_y2},smartpoint2=AMAMAPS.AMAMercator_2_SmartUnits(MercatorPoint2)),ary[iCounter]={x:smartpoint1.x,y:smartpoint1.y},ary2[iCounter]={x:smartpoint2.x,y:smartpoint2.y},arIndex[iCounter]=i,iCounter++}}for(ary.length>1?this.setMapRectToPois(ary,ary2,thisMap,.2,.2):ary2[0].x>0?this.setMapRectToPois(ary,ary2,thisMap,.05,.05):(zoomLevel=this.getZoomlevel(),this.setMapRectToSinglePoi(ary,thisMap,zoomLevel)),MapRect=thisMap.getRect(),this.MapDx=MapRect.right-MapRect.left,this.MapDy=MapRect.top-MapRect.bottom,this.MapRect=MapRect,i=0;i<ary.length;i++){var iIndex=arIndex[i],mggAry=geocodingResults[iIndex].split("|"),idsmall=mggAry[0];PoiIds!=null&&PoiIds.indexOf("|"+idsmall+"|")<0||(_poityp=mggAry[6],bShowInfoxBox=mggAry[7]!=null&&mggAry[7]!="",_PoiImage=this.flagImages.Path+_poityp+this.flagImages.Extension,idsmall==""&&(idsmall=mggAry[1]+" "+mggAry[2]+"_"+mggAry[3]),ary2[i].x==0&&mggAry[0]!="*unused*"?mggAry.length==10?this.drawPOIWithInfobox(thisMap,ary[i].x,ary[i].y,_PoiImage,mggAry[1],idsmall,bShowInfoxBox,mggAry[8]):this.drawPOIWithInfobox(thisMap,ary[i].x,ary[i].y,_PoiImage,mggAry[1],idsmall,bShowInfoxBox):ary2[i].x!=0&&this.MarkRegionsWithIcon&&(xCenter=(ary[i].x+ary2[i].x)/2,yCenter=(ary[i].y+ary2[i].y)/2,this.drawPOIWithInfobox(thisMap,xCenter,yCenter,_PoiImage,mggAry[1],idsmall,bShowInfoxBox)))}}}}},this.ZoomMapOutAndShowResults=function(isNew,PoiIds){if(CAMPINGGUI.zoomedout==!1){document.SR_isNew=isNew,document.SR_PoiIds=PoiIds;var funcName="MGLMapInitZoomedOut";CAMPINGGUI.expandMap("+",funcName)}else RUFPOIS.showResults(isNew,PoiIds)},this.showResultsSinglePoisFromDocument=function(){var isNew=document.SR_isNew,PoiIds=document.SR_PoiIds;RUFPOIS.showResults(isNew,PoiIds)},this.ZoomMapOutAndShowResults=function(isNew,PoiIds){if(CAMPINGGUI.zoomedout==!1){document.SR_isNew=isNew,document.SR_PoiIds=PoiIds;var funcName="MGLMapInitZoomedOut";CAMPINGGUI.expandMap("+",funcName)}else RUFPOIS.showResults(isNew,PoiIds)},this.showResultsSinglePoisFromDocument=function(){var isNew=document.SR_isNew,PoiIds=document.SR_PoiIds;RUFPOIS.showResults(isNew,PoiIds)},this.setMapRectToPois=function(poiary,poiary2,thisMap,dMarginFactorX,dMarginFactorY){var xMin=99999999,xMax=0,yMin=99999999,yMax=0,i,MarginX,MarginY;if(poiary.length>0){for(i=0;i<poiary.length;i++)xMin>poiary[i].x&&(xMin=poiary[i].x),xMax<poiary[i].x&&(xMax=poiary[i].x),yMin>poiary[i].y&&(yMin=poiary[i].y),yMax<poiary[i].y&&(yMax=poiary[i].y),poiary2[i].x!=0&&(xMin>poiary2[i].x&&(xMin=poiary2[i].x),xMax<poiary2[i].x&&(xMax=poiary2[i].x),yMin>poiary2[i].y&&(yMin=poiary2[i].y),yMax<poiary2[i].y&&(yMax=poiary2[i].y));MarginX=(xMax-xMin)*dMarginFactorX,MarginY=(yMax-yMin)*dMarginFactorY,thisMap.setRect(xMin-MarginX,yMin-MarginY,xMax+MarginX,yMax+MarginY)}},this.setMapRect=function(_x1,_y1,_x2,_y2){var MercatorPoint1={x:_x1,y:_y1},smartpoint1=AMAMAPS.AMAMercator_2_SmartUnits(MercatorPoint1),smartpoint2={x:0,y:0},MercatorPoint2;_x2!=0&&(MercatorPoint2={x:_x2,y:_y2},smartpoint2=AMAMAPS.AMAMercator_2_SmartUnits(MercatorPoint2)),ary[i]={x:smartpoint1.x,y:smartpoint1.y},ary2[i]={x:smartpoint2.x,y:smartpoint2.y},this.setMapRectToPois(ary,ary2,thisMap,.05,.05)},this.setMapRectToSinglePoi=function(poiary,thisMap,dZoomFactor){poiary.length==1&&(thisMap.setCenter(poiary[0]),thisMap.setZoom(dZoomFactor))},this.getResultAsMggStrings=function(){var mggs=null,ctrl=null,liElements,i;ctrl=$get(GetRenderedId(this.HiddenListboxId.Active));if(ctrl!=null&&ctrl.childNodes.length>0)for(liElements=ctrl.getElementsByTagName("option"),mggs=new Array(liElements.length),i=0;i<liElements.length;i++)mggs[i]=liElements[i].attributes.value.value;return mggs},this.getZoomlevel=function(){var zoomlevel=12,ctrl=$get("hidZoomlevel");if(ctrl!=null)try{zoomlevel=parseInt(ctrl.value)}catch(err){zoomlevel=12}return zoomlevel},this.drawPOI=function(thisMap,geoX,geoY,image,label,id){this.drawPOIWithInfobox(thisMap,geoX,geoY,image,label,id,!1)},this.drawPOIWithInfobox=function(thisMap,geoX,geoY,image,label,id,bShowInfoxBox,labelLink){var vectorLayer,poi,clickArea,me;return thisMap!=null&&id!=""?(vectorLayer=thisMap.getLayer("vector"),poi=typeof labelLink=="undefined"||labelLink==null?new com.ptvag.webcomponent.map.vector.POI(geoX,geoY,image,65,label,null,0,id):new com.ptvag.webcomponent.map.vector.POI(geoX,geoY,image,65,"<a href='"+labelLink+"'>"+label+"</a>",null,0,id),poi.setTolerance(30),vectorLayer.addElement(poi),bShowInfoxBox&&(clickArea=new com.ptvag.webcomponent.map.vector.ClickArea,clickArea.setId("clickarea:"+id),clickArea.setPriority(5),clickArea.set({x:geoX,y:geoY,tolerance:20}),me=this,clickArea.setHandler(function(evt){for(var url="",x,y,smartpoint1,geocodingResults=me.getResultAsMggStrings(),mggAry,MercatorPoint1,i=0;i<geocodingResults.length;i++){mggAry=geocodingResults[i].split("|");if("clickarea:"+mggAry[0]==evt.id){htmlContent=mggAry[7],_x1=parseFloat(mggAry[2]),_y1=parseFloat(mggAry[3]),MercatorPoint1={x:_x1,y:_y1},smartpoint1=AMAMAPS.AMAMercator_2_SmartUnits(MercatorPoint1);break}}me.showHideInfoBox(smartpoint1.x,smartpoint1.y,htmlContent,evt.id,!0)}),vectorLayer.addElement(clickArea)),poi):null},this.drawMercatorPOIAndCenterMap=function(geoX,geoY,image,label,id,dZoomFactor){var thisMap=AMAMAPS.AMAgetAJAXMapReference(),ary;if(thisMap!=null){var MercatorPoint={x:geoX,y:geoY},smartpoint=AMAMAPS.AMAMercator_2_SmartUnits(MercatorPoint),vectorLayer=thisMap.getLayer("vector"),poi=new com.ptvag.webcomponent.map.vector.POI(smartpoint.x,smartpoint.y,image,65,label,null,null,id);vectorLayer.addElement(poi),ary=new Array(1),ary[0]={x:smartpoint.x,y:smartpoint.y},this.setMapRectToSinglePoi(ary,thisMap,dZoomFactor)}},this.clearAllElements=function(){var thisMap=AMAMAPS.AMAgetAJAXMapReference(),vectorLayer;thisMap!=null&&(vectorLayer=thisMap.getLayer("vector"),vectorLayer.removeAllElements())},this.showGeoPOI=function(selectedElement){var callbackUrl,serializedData;if(selectedElement==null)return;var selectedText=selectedElement.text,selectedValue=selectedElement.value,debugoutputdiv=document.getElementById("geolayerdebug");debugoutputdiv!=null&&(debugoutputdiv.innerHTML=selectedElement.value);var ary=selectedValue.split("|"),x1=ary[0],y1=ary[1],x2=ary[2],y2=ary[3],_x1=parseFloat(x1),_y1=parseFloat(y1),_x2=parseFloat(x2),_y2=parseFloat(y2),_poix=0,_poiy=0;_x2==0?(_poix=_x1,_poiy=_y1):(_poix=(_x1+_x2)/2,_poiy=(_y1+_y2)/2),callbackUrl="/RuF/MapHandler.asmx/GetStaticMap",serializedData='{"x1":'+parseInt(window.mapX1)+',"x2":'+parseInt(window.mapX2)+',"y1":'+parseInt(window.mapY1)+',"y2":'+parseInt(window.mapY2)+',"poiX":'+parseInt(_poix)+',"poiY":'+parseInt(_poiy)+',"poiName":"","poiTyp":"fahne_klein","mapWidth":288,"mapHeight":310, "mapMode":"'+window.mapModeStaticMap+'"}',$j.ajaxSetup({beforeSend:function(){$j("#errorindicator").hide(),$j("#busyindicator").show()},complete:function(){window.setTimeout(function(){$j("#busyindicator").hide()},1e3)},error:function(){$j("#errorindicator").show()},success:function(){$j("#errorindicator").hide()}}),$j.ajax({url:callbackUrl,type:"post",contentType:"application/json; charset=utf-8",dataType:"json",data:serializedData,success:function(data){var mapimageurl=ChangeProtocolToWindowProtocol(data.d.mapimageurl);$j(".map-content > img").attr("src",mapimageurl)},error:function(){$j("#errorindicator").show()}})},ChangeProtocolToWindowProtocol=function(mapimageurl){var urlwithoutprotocol=mapimageurl.substring(mapimageurl.indexOf("//"));return window.location.protocol+urlwithoutprotocol},this.SmartpointIsOnMapRect=function(smartPoint){var thisMap=AMAMAPS.AMAgetAJAXMapReference(),rect=thisMap.getRect();return smartPoint.x>=rect.left&&smartPoint.x<=rect.right&&smartPoint.y>=rect.bottom&&smartPoint.y<=rect.top},this.selectionChangedGeoLayer=function(smartpoint,smartpoint2,poiid,label,poityp,srltyp,landid,regionid,stadtid,plz,remove){var idsmall,thisMap,vectorLayer,left,right,tmpx,top,bottom,tmpy,bPoiTypZoom,ary,dZoomFactor;this.selectedKey=poiid,idsmall="pin_s_"+poiid,thisMap=AMAMAPS.AMAgetAJAXMapReference();if(thisMap!=null){vectorLayer=thisMap.getLayer("vector"),this.oldFlagID!=null&&vectorLayer.removeElement("infobox_"+this.bigFlagLabel);if(poiid!="")this.highlightFlag(smartPoint.x,smartPoint.y,label,remove);else if(smartpoint2!=null){var xCenter=(smartpoint.x+smartpoint2.x)/2,yCenter=(smartpoint.y+smartpoint2.y)/2,bZoomToRect=!1;bZoomToRect&&(left=smartpoint.x,right=smartpoint2.x,left>right&&(tmpx=left,left=right,right=tmpx),top=smartpoint.y,bottom=smartpoint2.y,bottom>top&&(tmpy=bottom,bottom=top,top=tmpy),thisMap.setRect(left,top,right,bottom,!1)),this.highlightFlag(xCenter,yCenter,label,remove)}else bPoiTypZoom=!1,bPoiTypZoom&&(ary=new Array(1),dZoomFactor=10,ary[0]={x:smartpoint.x,y:smartpoint.y},srltyp=="S"?dZoomFactor=12:srltyp=="R"?dZoomFactor=17:srltyp=="L"&&(dZoomFactorthis=20),this.setMapRectToSinglePoi(ary,thisMap,dZoomFactor)),this.highlightFlag(smartpoint.x,smartpoint.y,label,remove)}},this.InitMapInGeocodingLayer=function(){var _x1,_y1,_x2,_y2,i,mggAry,dx,dy,callbackUrl,serializedData;window.mapModeStaticMap="WORLD",typeof window.geocodingMode!="undefined"&&(window.geocodingMode.toLowerCase()=="tourmail"?window.mapModeStaticMap="WORLD":window.geocodingMode.toLowerCase()=="maps_zielsucheeu"?window.mapModeStaticMap="EU":window.geocodingMode.toLowerCase()=="wetter"?window.mapModeStaticMap="WORLD":window.geocodingMode.toLowerCase()=="default"&&(window.mapModeStaticMap="WORLD")),window.mapX1=99999999,window.mapX2=-999999999,window.mapY1=99999999,window.mapY2=-999999999;var _poix=0,_poiy=0,geocodingResults=this.getResultAsMggStrings();if(geocodingResults!=null)if(geocodingResults.length>0){for(i=0;i<geocodingResults.length;i++)mggAry=geocodingResults[i].split("|"),_x1=parseFloat(mggAry[2]),_y1=parseFloat(mggAry[3]),_x2=parseFloat(mggAry[4]),_y2=parseFloat(mggAry[5]),this.CheckMapCoordinatesFromPoi(_x1,_y1),this.CheckMapCoordinatesFromPoi(_x2,_y2),i==0&&(_x2==0?(_poix=_x1,_poiy=_y1):(_poix=(_x1+_x2)/2,_poiy=(_y1+_y2)/2));geocodingResults.length==1?(window.mapX1-=this.MapDx,window.mapX2+=this.MapDx,window.mapY1-=this.MapDy,window.mapY2+=this.MapDy):(dx=(window.mapX2-window.mapX1)*.1,dy=(window.mapY2-window.mapY1)*.1,window.mapX1-=dx,window.mapX2+=dx,window.mapY1-=dy,window.mapY2+=dy),callbackUrl="/RuF/MapHandler.asmx/GetStaticMap",serializedData='{"x1":'+parseInt(window.mapX1)+',"x2":'+parseInt(window.mapX2)+',"y1":'+parseInt(window.mapY1)+',"y2":'+parseInt(window.mapY2)+',"poiX":'+parseInt(_poix)+',"poiY":'+parseInt(_poiy)+',"poiName":"","poiTyp":"fahne_klein","mapWidth":288,"mapHeight":310, "mapMode":"'+window.mapModeStaticMap+'"}',$j.ajaxSetup({beforeSend:function(){$j("#errorindicator").hide(),$j("#busyindicator").show()},complete:function(){$j("#busyindicator").hide()},error:function(){$j("#errorindicator").show()},success:function(){$j("#errorindicator").hide()}}),$j.ajax({url:callbackUrl,type:"post",contentType:"application/json; charset=utf-8",dataType:"json",data:serializedData,success:function(data){var mapimageurl=ChangeProtocolToWindowProtocol(data.d.mapimageurl);$j(".map-content > img").attr("src",mapimageurl)},error:function(xhr){alert("Fehler beim Abrufen der Karte: "+xhr.StatusText)}})}},this.CheckMapCoordinatesFromPoi=function(x,y){x!=0&&y!=0&&((x<window.mapX1||window.mapX1==0)&&(window.mapX1=x),(x>window.mapX2||window.mapX2==0)&&(window.mapX2=x),(y<window.mapY1||window.mapY1==0)&&(window.mapY1=y),(y>window.mapY2||window.mapY2==0)&&(window.mapY2=y))},this.selectionChanged=function(key,remove){var vectorLayer,dX,dY;this.selectedKey=key;var mggAry=key.split("|"),_x=parseFloat(mggAry[2]),_y=parseFloat(mggAry[3]),MercatorPoint={x:_x,y:_y},smartPoint=AMAMAPS.AMAMercator_2_SmartUnits(MercatorPoint),idsmall="pin_s_"+mggAry[0],thisMap=AMAMAPS.AMAgetAJAXMapReference();thisMap!=null&&(vectorLayer=thisMap.getLayer("vector"),this.oldFlagID!=null&&vectorLayer.removeElement("infobox_"+this.bigFlagLabel),this.highlightFlag(smartPoint.x,smartPoint.y,mggAry[1],remove),dX=this.MapDx/2,dY=this.MapDy/2,thisMap.setRect(smartPoint.x-dX,smartPoint.y-dY,smartPoint.x+dX,smartPoint.y+dY))},this.highlightFlag=function(geoXSmart,geoYSmart,label,remove){var thisMap=AMAMAPS.AMAgetAJAXMapReference(),revGeocodingLabel,Poi;if(thisMap!=null)if(label!=null){var vectorLayer=thisMap.getLayer("vector"),idsmall="pin_s_"+label,idbig="pin_b_"+label;vectorLayer.removeElement(idsmall),this.oldFlagID=idsmall,this.oldFlagLabel=label,this.oldX=geoXSmart,this.oldY=geoYSmart,vectorLayer.removeElement(this.bigFlagLabel),this.bigFlagLabel=idbig,label.indexOf("#")>0?(revGeocodingLabel=label.split("#"),idbig="pin_b_"+revGeocodingLabel[0],this.destination=revGeocodingLabel[0],Poi=this.drawPOI(thisMap,geoXSmart,geoYSmart,this.flagImages.Big,revGeocodingLabel[0],idbig)):remove||this.showHideInfoBox(geoXSmart,geoYSmart,label,idbig,!1)}},this.showHideInfoBox=function(suX,suY,content,infoid,showCloseWidget){var infoBox,manager;useStandardBoxes();var thisMap=AMAMAPS.AMAgetAJAXMapReference(),layer=thisMap.getLayer("vector"),id="infobox_"+infoid;lastActiveInfoBox=id,infoBox=new com.ptvag.webcomponent.map.vector.InfoBox(suX,suY,content,null,null,id,!1),infoBox.setShowCloseWidget(showCloseWidget),manager=thisMap.getServerDrawnObjectManager(),manager.setDefaultStaticPOITooltips(!1),layer.addElement(infoBox)},useStandardBoxes=function(){var factory=com.ptvag.webcomponent.map.vector.InfoBoxElementFactoryDefault.getInstance();com.ptvag.webcomponent.map.vector.InfoBoxElementFactory=factory},useRoundBoxes=function(){var factory=com.ptvag.webcomponent.map.vector.InfoBoxElementFactoryRound.getInstance();com.ptvag.webcomponent.map.vector.InfoBoxElementFactory=factory}}var RUFPOIS=new RuFPois;window.mapX1=99999999,window.mapX2=-999999999,window.mapY1=99999999,window.mapY2=-999999999;